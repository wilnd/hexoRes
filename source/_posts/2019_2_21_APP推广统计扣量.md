---
title: 2019_2_21_APP推广统计扣量
date: 2019-02-28 11:00:50
tags: 需求分析
categories: 需求分析
---
入口:在代理商设置处设置基数以及比例
1. 凌晨时固化历史数据
2. 查询扣量规则时需要考虑历史扣量的情况

```
历史数据需要包括:
1. 未扣量的值
2. 上次扣量规则剩下的值
3. 扣量基数
4. 扣量比例
5. 
```

3. 明细值的查询(暂时不做)


#### 关键过程

##### 对于历史数据
```
直接显示
```
##### 对于当天数据查询
1. 没有规则
```
直接展示
```
2. 有规则
- 上条规则不在当天

```
当前注册数未超过基数:
    展示当天的注册数
当前注册数超过基数:
    使用公式:
        当天注册数 = 基数 + (当前注册数 - 基数) * 扣量比例
```
- 上条规则在当天
```
场景1:实际浏览数 - 上次固化扣量前实际注册数量 - 变更后注册数扣量基数 < 0
    使用公式:
        当天注册数 = 实际浏览数 - 上次固化扣量前实际注册数量 + 上次固化扣量后的实际注册数量
场景2:实际浏览数 - 上次固化扣量前实际注册数量 - 变更后注册数扣量基数 > 0
    使用公式:
        当天注册数 = 上次固化扣量后的实际注册数量 + 变更后注册数扣量基数 + (实际浏览数 - 上次固化扣量前实际注册数量 - 变更后注册数扣量基数)*变更后注册数扣量比例
```

##### 设置扣量规则
- 当天无新的扣量规则
```
1. 之前无的扣量规则
设置:
变更后注册数扣量基数
变更后注册数扣量比例 0-100
上次固化扣量前实际注册数量 = 实际注册数
上次固化扣量后的实际注册数量 = 实际注册数

2. 之前有扣量规则
变更前注册数扣量基数
变更前注册数扣量比例 0-100
变更后注册数扣量基数
变更后注册数扣量比例 0-100
上次固化扣量前实际注册数量 = 实际注册数
上次固化扣量后的实际注册数量 = 基数 + (当前注册数 - 基数) * 扣量比例
```
- 当天有扣量规则

```
变更前注册数扣量基数
变更前注册数扣量比例 0-100
变更后注册数扣量基数
变更后注册数扣量比例 0-100
上次固化扣量前实际注册数量 = 实际注册数
上次固化扣量后的实际注册数量 = 上调记录的上次固化扣量后的实际注册数量 + 变更后注册数扣量基数 + (当前实际浏览数 - 上调记录的上次固化扣量前实际注册数量 - 变更后注册数扣量基数)*变更后注册数扣量比例

```

